@model XRayDiagnosticSystem.Models.Patient

@{
    ViewData["Title"] = "Register Patient";
}

<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="glass-card fade-in">
            <div class="mb-4">
                <a asp-action="Index" class="text-decoration-none text-muted mb-3 d-inline-block">
                    <i class="fas fa-arrow-left me-1"></i> Back to Registry
                </a>
                <h3 class="fw-bold">Patient Demographics</h3>
                <p class="text-muted">Please fill in the patient details accurately.</p>
            </div>

            <form asp-action="Create" id="patientForm">
                <div class="row g-3">
                    <div class="col-md-12">
                        <label class="form-label fw-semibold">Full Legal Name</label>
                        <input asp-for="FullName" id="fullName" class="form-control rounded-3" placeholder="e.g. Johnathan Doe" required />
                        <div id="nameFeedback" class="form-text text-danger d-none">Please use letters only for the full name.</div>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label fw-semibold">Age</label>
                        <input asp-for="Age" id="age" type="number" class="form-control rounded-3" min="0" max="120" required />
                        <div class="form-text text-danger d-none" id="ageFeedback">Please enter a valid age (0-120).</div>
                    </div>
                    <!-- ... rest of the form ... -->
                    <div class="col-md-6">
                        <label class="form-label fw-semibold">Gender</label>
                        <select asp-for="Gender" class="form-select rounded-3">
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label fw-semibold">Contact Number</label>
                        <input asp-for="ContactNumber" id="contact" class="form-control rounded-3" placeholder="10-digit mobile" required />
                        <div id="contactFeedback" class="form-text text-danger d-none" style="font-size: 0.75rem;"><i class="fas fa-exclamation-circle me-1"></i>Please enter exactly 10 digits.</div>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label fw-semibold">Address</label>
                        <input asp-for="Address" class="form-control rounded-3" />
                    </div>
                </div>

                <div class="mt-5 d-grid">
                    <button type="submit" id="submitBtn" class="btn btn-premium py-3">
                        <i class="fas fa-save me-2"></i> Complete Registration
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const fullName = document.getElementById('fullName');
        const nameFeedback = document.getElementById('nameFeedback');
        const contact = document.getElementById('contact');
        const contactFeedback = document.getElementById('contactFeedback');
        const form = document.getElementById('patientForm');

        // Regex for letters and spaces only
        const nameRegex = /^[A-Za-z\s]*$/;

        fullName.addEventListener('input', function () {
            if (!nameRegex.test(this.value)) {
                this.value = this.value.replace(/[^A-Za-z\s]/g, '');
                nameFeedback.classList.remove('d-none');
                setTimeout(() => nameFeedback.classList.add('d-none'), 3000);
            }
        });

        contact.addEventListener('input', function () {
            this.value = this.value.replace(/\D/g, '').substring(0, 10);
            if (this.value.length === 10) {
                contactFeedback.classList.add('d-none');
                this.setCustomValidity('');
            } else {
                contactFeedback.classList.remove('d-none');
                this.setCustomValidity('Invalid');
            }
        });

        form.addEventListener('submit', function (e) {
            const submitBtn = document.getElementById('submitBtn');
            let isValid = true;
            
            if (fullName.value.length < 2) {
                isValid = false;
                alert('Please enter a valid name.');
            }

            const ageLabel = document.getElementById('age');
            if (ageLabel.value < 0 || ageLabel.value > 120) {
                isValid = false;
                document.getElementById('ageFeedback').classList.remove('d-none');
            }

            if (contact.value.length !== 10) {
                isValid = false;
                contactFeedback.classList.remove('d-none');
            }

            if (!isValid) {
                e.preventDefault();
            } else {
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Creating Profile...';
            }
        });
    });
</script>
